// Copy and paste this entire code to https://dbdiagram.io/d
// GYMMS - Gym Membership Management System Database Schema

Table StaffUser {
  id integer [pk, increment]
  username varchar(150) [unique, not null]
  name varchar(255) [null]
  email varchar(254) [not null]
  password varchar(128) [not null]
  phone_number varchar(20) [null]
  profile_image varchar(100) [null]
  role varchar(10) [default: 'Staff', not null]
  created_by_id integer [null]
  is_email_verified boolean [default: false]
  is_phone_verified boolean [default: false]
  last_password_change timestamp [null]
  is_active boolean [default: true]
  is_staff boolean [default: false]
  is_superuser boolean [default: false]
  date_joined timestamp [not null]
  last_login timestamp [null]
}

Table Member {
  id integer [pk, increment]
  member_id varchar(10) [unique, not null]
  name varchar(150) [not null]
  email varchar(254) [null]
  phone_number varchar(20) [not null]
  sex varchar(7) [null]
  address text [not null]
  photo varchar(100) [null]
  emergency_contact varchar(100) [not null]
  emergency_phone varchar(20) [not null]
  start_date date [not null]
  end_date date [not null]
  membership_fee decimal(10,2) [not null]
  is_active boolean [default: true]
  created_by_id integer [null]
  date_created timestamp [not null]
  is_deleted boolean [default: false]
  deleted_at timestamp [null]
}

Table MembershipPricing {
  id integer [pk, increment]
  duration_days integer [not null]
  duration_label varchar(50) [not null]
  price decimal(10,2) [not null]
  is_active boolean [default: true]
  last_modified timestamp [not null]
}

Table MembershipConfig {
  id integer [pk, increment]
  membership_fee decimal(10,2) [not null]
  last_modified timestamp [not null]
}

Table Payment {
  id uuid [pk]
  member_fk_id integer [null]
  stored_member_id varchar(10) [default: 'UNKNOWN', not null]
  stored_member_name varchar(150) [default: 'Unknown Member', not null]
  membership_plan_id integer [null]
  stored_plan_label varchar(50) [default: 'Unknown Plan', not null]
  stored_duration_days integer [default: 0, not null]
  amount decimal(10,2) [default: 0.00, not null]
  payment_method varchar(50) [default: 'Cash', not null]
  reference_number varchar(100) [null]
  payment_date timestamp [not null]
  status varchar(20) [default: 'Completed', not null]
  processed_by_id integer [null]
  remarks text [null]
  created_at timestamp [not null]
  updated_at timestamp [not null]
}

Table PaymentSummary {
  id integer [pk, increment]
  month date [unique, not null]
  total_income decimal(10,2) [not null]
  total_transactions integer [not null]
  generated_at timestamp [not null]
}

Table GymCheckIn {
  id integer [pk, increment]
  member_id integer [not null]
  check_in_time timestamp [not null]
  check_out_time timestamp [null]
  date date [not null]
}

Table DashboardStats {
  id integer [pk, increment]
  date date [unique, not null]
  daily_walk_ins integer [default: 0]
  total_check_ins integer [default: 0]
  total_revenue decimal(12,2) [default: 0.00]
  active_members integer [default: 0]
  new_members integer [default: 0]
  last_updated timestamp [not null]
}

Table ActiveMemberSnapshot {
  id integer [pk, increment]
  date date [unique, not null]
  active_count integer [default: 0]
  total_members integer [default: 0]
  new_members_today integer [default: 0]
  expired_today integer [default: 0]
  total_revenue_today decimal(12,2) [default: 0.00]
  check_ins_today integer [default: 0]
  created_at timestamp [not null]
}

// Relationships
Ref: StaffUser.created_by_id > StaffUser.id
Ref: Member.created_by_id > StaffUser.id
Ref: Payment.member_fk_id > Member.id
Ref: Payment.membership_plan_id > MembershipPricing.id
Ref: Payment.processed_by_id > StaffUser.id
Ref: GymCheckIn.member_id > Member.id