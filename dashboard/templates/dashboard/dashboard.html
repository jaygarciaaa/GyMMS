{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
	<meta name="description" content="GyMMS Dashboard - Manage your gym operations">
	<title>Dashboard | GyMMS</title>
	<link rel="stylesheet" href="{% static 'core/css/index.css' %}">
	<link rel="stylesheet" href="{% static 'dashboard/css/dashboard.css' %}?v=9">
</head>
<body>
	{% include 'core/navbar.html' %}

	<main class="container" style="margin-top:0.5rem">
		<div class="dashboard-container">
			<!-- Dashboard Header -->
			<div class="dashboard-header">
				<h1>Dashboard</h1>
				<div class="dashboard-subtitle">
					<div class="user-info">
						<span>Welcome back, <strong>{{ user.get_full_name|default:user.username }}</strong>!</span>
					</div>
					<div class="live-time">
						<span class="live-indicator"></span>
						<span id="currentTime">{{ current_time|date:"F d, Y - h:i A" }}</span>
					</div>
				</div>
			</div>

			<!-- Main Content Wrapper -->
			<div class="main-content-wrapper">
				<!-- Stats Grid -->
				<div class="stats-grid">
					<!-- Daily Walk-ins -->
					<div class="stat-card">
						<div class="stat-header">
							<div>
								<a href="{% url 'metrics:metrics' %}" class="stat-label">Daily Walk-ins</a>
								<div class="stat-value">{{ daily_walk_ins }}</div>
								<div class="stat-trend">Today's unique visitors</div>
							</div>
							<div class="stat-icon">üëü</div>
						</div>
					</div>

					<!-- Monthly Check-ins -->
					<div class="stat-card members">
						<div class="stat-header">
							<div>
								<a href="{% url 'metrics:metrics' %}" class="stat-label">Monthly Check-ins</a>
								<div class="stat-value">{{ monthly_check_ins }}</div>
								<div class="stat-trend">Total visits this month</div>
							</div>
							<div class="stat-icon">üìÖ</div>
						</div>
					</div>

					<!-- Today's Revenue -->
					<div class="stat-card revenue">
						<div class="stat-header">
							<div>
								<div class="stat-label">
									<a href="{% url 'metrics:metrics' %}" style="color: inherit;">Today's Revenue</a>
									<button class="revenue-toggle" id="revenueToggle" aria-label="Toggle revenue visibility">
										<svg class="eye-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
											<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
											<circle cx="12" cy="12" r="3"></circle>
										</svg>
										<svg class="eye-off-icon" style="display: none;" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
											<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
											<line x1="1" y1="1" x2="23" y2="23"></line>
										</svg>
									</button>
								</div>
								<div class="stat-value">
									<span class="revenue-amount" data-today="{{ today_revenue|floatformat:2 }}" data-monthly="{{ monthly_revenue|floatformat:2 }}">‚Ç±{{ today_revenue|floatformat:2 }}</span>
								</div>
								<div class="stat-trend">
									Monthly: <span class="revenue-monthly" data-monthly="{{ monthly_revenue|floatformat:2 }}">‚Ç±{{ monthly_revenue|floatformat:2 }}</span>
								</div>
							</div>
							<div class="stat-icon">üí∞</div>
						</div>
					</div>
				</div>

				<!-- Content Grid -->
				<div class="content-grid">
					<!-- Recent Activity -->
					<div class="activity-card">
					<div class="card-header">
						<a href="{% url 'metrics:metrics' %}" class="card-title">Recent Check-ins</a>
						<div class="card-header-actions">
							<span class="card-badge">{{ recent_check_ins|length }}</span>
							<button type="button" class="btn-check-in" id="btnCheckIn">
								<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
									<circle cx="9" cy="7" r="4"></circle>
									<line x1="19" y1="8" x2="19" y2="14"></line>
									<line x1="22" y1="11" x2="16" y2="11"></line>
								</svg>
								Log Check-in
							</button>
						</div>
					</div>
					
					{% if recent_check_ins %}
						<div class="activity-list">
							{% for check_in in recent_check_ins %}
							<div class="activity-item">
								<div class="activity-avatar">
									{{ check_in.member.first_name|first|upper }}{{ check_in.member.last_name|first|upper }}
								</div>
								<div class="activity-details">
									<div class="activity-name">
										{{ check_in.member.get_full_name }}
									</div>
									<div class="activity-time">
										{{ check_in.check_in_time|timesince }} ago
										{% if check_in.check_out_time %}
											‚Ä¢ Duration: {{ check_in.duration }}
										{% endif %}
									</div>
								</div>
								{% if check_in.check_out_time %}
									<span class="activity-status status-out">Checked Out</span>
								{% else %}
									<span class="activity-status status-in">In Gym</span>
								{% endif %}
							</div>
							{% endfor %}
						</div>
					{% else %}
						<div class="empty-state">
							<div class="empty-state-icon">üîç</div>
							<p>No check-ins today</p>
						</div>
					{% endif %}
				</div>

				<!-- Quick Stats Sidebar -->
				<div class="quick-stats">
					<!-- Active Members -->
					<div class="mini-card">
						<a href="{% url 'memberships:memberships' %}?filter=active" class="mini-card-header">Active Members</a>
						<div class="mini-card-value">{{ active_members }}</div>
						<div class="mini-card-footer">Current active memberships</div>
					</div>

					<!-- Expiring Soon -->
					<div class="mini-card alert">
						<a href="{% url 'memberships:memberships' %}?filter=expiring" class="mini-card-header">Expiring Soon</a>
						<div class="mini-card-value">{{ expiring_soon }}</div>
						<div class="mini-card-footer">Within 3 days</div>
					</div>

					<!-- New Members -->
					<div class="mini-card members">
						<a href="{% url 'memberships:memberships' %}?filter=newest" class="mini-card-header">New This Month</a>
						<div class="mini-card-value">{{ new_members }}</div>
						<div class="mini-card-footer">New member registrations</div>
					</div>
				</div>

				<!-- Peak Hours Chart -->
				<div class="chart-container">
					<div class="card-header">
						<a href="{% url 'metrics:metrics' %}" class="card-title">Peak Hours Today</a>
					</div>
					<div class="chart-bars">
						{% for hour_data in peak_hours %}
						<div class="chart-bar" style="height: {% if peak_hours %}{{ hour_data.percentage }}%{% else %}10%{% endif %};">
							<span class="chart-bar-value">{{ hour_data.count }}</span>
							<span class="chart-bar-label">{{ hour_data.hour }}:00</span>
						</div>
						{% endfor %}
					</div>
				</div>
			</div>

			<!-- Check-in Modal -->
			<div class="modal" id="checkInModal">
				<div class="modal-content">
					<div class="modal-header">
						<h2>Log Member Check-in</h2>
						<button type="button" class="modal-close" id="closeModal">&times;</button>
					</div>
					<div class="modal-body">
						<div class="check-in-options">
							<button type="button" class="option-btn active" data-type="member">
								<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
									<circle cx="9" cy="7" r="4"></circle>
									<path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
									<path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
								</svg>
								Member Check-in
							</button>
							<button type="button" class="option-btn" data-type="walkin">
								<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
									<circle cx="9" cy="7" r="4"></circle>
									<line x1="19" y1="8" x2="19" y2="14"></line>
									<line x1="22" y1="11" x2="16" y2="11"></line>
								</svg>
								Walk-in Guest
							</button>
						</div>

						<!-- Member Check-in Form -->
						<form id="memberCheckInForm" class="check-in-form active">
							<div class="form-group">
								<label for="memberSearch">Search Member</label>
								<div class="search-container">
									<input type="text" id="memberSearch" placeholder="Search by Member ID or Name..." autocomplete="off">
									<div class="search-results-dropdown" id="memberSearchResults"></div>
								</div>
							</div>
							<div class="selected-member-info" id="selectedMemberInfo" style="display: none;">
								<div class="member-card">
									<div class="member-card-avatar" id="memberCardAvatar"></div>
									<div class="member-card-details">
										<h4 id="memberCardName"></h4>
										<p id="memberCardId"></p>
										<span class="member-card-status" id="memberCardStatus"></span>
									</div>
								</div>
							</div>
							<input type="hidden" id="selectedMemberId">
							<div class="modal-actions">
								<button type="button" class="btn-secondary" id="cancelMemberCheckIn">Cancel</button>
								<button type="submit" class="btn-primary" id="submitMemberCheckIn">Log Check-in</button>
							</div>
						</form>

						<!-- Walk-in Guest Form -->
						<form id="walkInForm" class="check-in-form">
							<p class="walk-in-notice">Walk-in guests will be redirected to payment processing.</p>
							<div class="form-group">
								<label for="guestName">Guest Name</label>
								<input type="text" id="guestName" placeholder="Enter guest name" value="Guest" required>
							</div>
							<div class="form-group">
								<label for="guestGender">Gender</label>
								<select id="guestGender" required>
									<option value="">Select gender</option>
									<option value="Male">Male</option>
									<option value="Female">Female</option>
								</select>
							</div>
							<div class="modal-actions">
								<button type="button" class="btn-secondary" id="cancelWalkIn">Cancel</button>
								<button type="submit" class="btn-primary" id="submitWalkIn">Proceed to Payment</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</main>

	<script defer src="{% static 'core/js/index.js' %}"></script>
	<script defer src="{% static 'dashboard/js/dashboard.js' %}"></script>
</body>
</html>