{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
	<meta name="description" content="GyMMS Dashboard - Manage your gym operations">
	<title>Dashboard | GyMMS</title>
	<link rel="stylesheet" href="{% static 'core/css/index.css' %}">
	<link rel="stylesheet" href="{% static 'dashboard/css/dashboard.css' %}?v=13">
</head>
<body>
	{% include 'core/navbar.html' %}

	<main class="container" style="margin-top:0.5rem">
		<div class="dashboard-container">
			<!-- Dashboard Header -->
			<div class="dashboard-header">
				<h1>Dashboard</h1>
				<div class="dashboard-subtitle">
					<div class="user-info">
						<span>Welcome back, <strong>{{ user.get_full_name|default:user.username }}</strong>!</span>
					</div>
					<div class="live-time">
						<span class="live-indicator"></span>
						<span id="currentTime">{{ current_time|date:"F d, Y - h:i A" }}</span>
					</div>
				</div>
			</div>

			<!-- Main Content Wrapper -->
			<div class="main-content-wrapper">
				<!-- Stats Grid -->
				<div class="stats-grid">
					<!-- Daily Walk-ins -->
					<div class="stat-card">
						<div class="stat-header">
							<div>
								<a href="{% url 'metrics:metrics' %}?filter=daily_walk_ins" class="stat-label">Daily Walk-ins</a>
								<div class="stat-value">{{ daily_walk_ins }}</div>
								<div class="stat-trend">Guest payments today</div>
							</div>
							<div class="stat-icon">üëü</div>
						</div>
					</div>

					<!-- Member Check-ins -->
					<div class="stat-card members">
						<div class="stat-header">
							<div>
								<a href="{% url 'metrics:metrics' %}?filter=total_check_ins" class="stat-label">Member Check-ins</a>
								<div class="stat-value">{{ member_check_ins }}</div>
								<div class="stat-trend">Members checked in today</div>
							</div>
							<div class="stat-icon">üìÖ</div>
						</div>
					</div>

					<!-- Today's Revenue -->
					<div class="stat-card revenue">
						<div class="stat-header">
							<div>
								<div class="stat-label">
									<a href="{% url 'metrics:metrics' %}?filter=total_revenue" style="color: inherit;">Today's Revenue</a>
									<button class="revenue-toggle" id="revenueToggle" aria-label="Toggle revenue visibility">
										<svg class="eye-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
											<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
											<circle cx="12" cy="12" r="3"></circle>
										</svg>
										<svg class="eye-off-icon" style="display: none;" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
											<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
											<line x1="1" y1="1" x2="23" y2="23"></line>
										</svg>
									</button>
								</div>
								<div class="stat-value">
									<span class="revenue-amount" data-today="{{ today_revenue|floatformat:2 }}">‚Ç±{{ today_revenue|floatformat:2 }}</span>
								</div>
								<div class="stat-trend">
									Monthly: <span class="revenue-monthly" data-monthly="{{ monthly_revenue|floatformat:2 }}">‚Ç±{{ monthly_revenue|floatformat:2 }}</span>
								</div>
							</div>
							<div class="stat-icon">üí∞</div>
						</div>
					</div>
				</div>

				<!-- Content Grid -->
				<div class="content-grid">
					<!-- Recent Activity -->
					<div class="activity-card">
					<div class="card-header">
						<a href="{% url 'metrics:metrics' %}" class="card-title">Recent Check-ins</a>
						<div class="card-header-actions">
							<span class="card-badge">{{ recent_check_ins|length }}</span>
							<button type="button" class="btn-check-in" id="btnCheckIn">
								<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
									<circle cx="9" cy="7" r="4"></circle>
									<line x1="19" y1="8" x2="19" y2="14"></line>
									<line x1="22" y1="11" x2="16" y2="11"></line>
								</svg>
								Log Check-in
							</button>
						</div>
					</div>
					
					{% if recent_check_ins %}
						<div class="activity-list">
							{% for check_in in recent_check_ins %}
							<div class="activity-item" style="border-bottom: 1px solid #e0e0e0; padding-bottom: 0.75rem; margin-bottom: 0.75rem;">
								<div class="activity-avatar">
									{% if check_in.photo %}
										<img src="{{ check_in.photo }}" alt="{{ check_in.name }}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
									{% else %}
										{% with names=check_in.name.split %}
											{% if names|length > 1 %}
												{{ names.0|first|upper }}{{ names.1|first|upper }}
											{% else %}
												{{ check_in.name|slice:":2"|upper }}
											{% endif %}
										{% endwith %}
									{% endif %}
								</div>
								<div class="activity-details">
									<div class="activity-name">
										{{ check_in.name }}
										{% if check_in.type == 'walkin' %}
											<span style="color: #666; font-size: 0.85em;">(Walk-in)</span>
										{% endif %}
									</div>
									<div class="activity-time">
										{{ check_in.time|date:"h:i A" }}
									</div>
								</div>
							</div>
							{% endfor %}
						</div>
					{% else %}
						<div class="empty-state">
							<div class="empty-state-icon">üîç</div>
							<p>No check-ins today</p>
						</div>
					{% endif %}
				</div>

				<!-- Quick Stats Sidebar -->
				<div class="quick-stats">
					<!-- Active Members -->
					<div class="mini-card">
						<a href="{% url 'memberships:memberships' %}?filter=active" class="mini-card-header">Active Members</a>
						<div class="mini-card-value">{{ active_members }}</div>
						<div class="mini-card-footer">Current active memberships</div>
					</div>

					<!-- Expiring Soon -->
					<div class="mini-card alert">
						<a href="{% url 'memberships:memberships' %}?filter=expiring" class="mini-card-header">Expiring Soon</a>
						<div class="mini-card-value">{{ expiring_soon }}</div>
						<div class="mini-card-footer">Within 3 days</div>
					</div>

				<!-- New Members -->
				<div class="mini-card members">
					<a href="{% url 'memberships:memberships' %}?filter=newest" class="mini-card-header">New This Month</a>
					<div class="mini-card-value">{{ new_members }}</div>
					<div class="mini-card-footer">New member registrations</div>
				</div>
			</div>
		</div>

		<!-- Peak Hours Chart Component -->
		{% include 'dashboard/peak_hours_chart.html' %}
	</div>
	{% include 'dashboard/checkin_modal.html' %}
		</div>
	</main>

	<script defer src="{% static 'core/js/index.js' %}"></script>
	<script defer src="{% static 'core/js/input-validator.js' %}"></script>
	<script defer src="{% static 'dashboard/js/dashboard.js' %}?v=3.2"></script>
</body>
</html>