{% load static %}
{% load tz %}
{% load member_filters %}
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Edit Member - {{ member.name }} | GyMMS</title>
	<link rel="stylesheet" href="{% static 'core/css/index.css' %}">
	<link rel="stylesheet" href="{% static 'memberships/css/member_details.css' %}">
</head>
<body>
	{% include 'core/navbar.html' %}

	<main class="container" style="margin-top:0.5rem">
		<div class="edit-member-container">
			<!-- Header -->
			<div class="edit-header">
				<div class="header-left">
					<a href="{% url 'memberships:memberships' %}" class="back-button">
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M19 12H5M12 19l-7-7 7-7"/>
						</svg>
						Back to Members
					</a>
					<h1>Member Details</h1>
					<p class="subtitle">View and update member information</p>
				</div>
				<div class="header-actions">
					<div class="member-status-badge">
						{% if member.is_membership_active %}
						<span class="status-badge active">Active Member</span>
						{% elif member.end_date < today %}
						<span class="status-badge expired">Expired</span>
						{% else %}
						<span class="status-badge inactive">Inactive</span>
						{% endif %}
					</div>
					<button type="button" class="btn-primary" id="toggleEditMode">
						<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
							<path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
						</svg>
						<span id="editModeText">Edit</span>
					</button>
				</div>
			</div>

			<!-- Member ID Card -->
			<div class="member-id-card">
				<div class="member-avatar-large" id="memberAvatarContainer">
					{% if member.photo and member.photo|photo_exists %}
					<img src="{{ member.photo.url }}" alt="{{ member.name }}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
					{% else %}
					{{ member.name|first|upper }}
					{% endif %}
					<div class="photo-edit-overlay" id="photoEditOverlay" style="display: none;">
						<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
							<circle cx="12" cy="13" r="4"></circle>
						</svg>
					</div>
				</div>
				<div class="member-id-info">
					<div class="member-name">{{ member.name }}</div>
					<div class="member-id-label">Member ID: <span class="member-id-value">{{ member.member_id }}</span></div>
					<div class="member-joined">Joined {{ member.date_created|localtime|date:"M d, Y" }}</div>
					{% if member.created_by %}
					<div class="member-created-by">Added by {{ member.created_by.username }}</div>
					{% endif %}
				</div>
			</div>

			<!-- Edit Form -->
			<form method="POST" action="{% url 'memberships:update_member' member.member_id %}" class="edit-form" id="memberForm" enctype="multipart/form-data">
				{% csrf_token %}
				
				<!-- Hidden photo inputs -->
				<input type="file" id="member_photo_edit" name="photo" accept="image/*" style="display: none;">
				<input type="file" id="camera_input_edit" accept="image/*" capture="environment" style="display: none;">
				
				<!-- Personal Information Section -->
				<div class="form-section">
					<div class="section-header">
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
							<circle cx="12" cy="7" r="4"></circle>
						</svg>
						<h2>Personal Information</h2>
					</div>
					<div class="form-grid">
						<div class="form-group">
							<label for="name">Full Name</label>
							<input type="text" id="name" name="name" value="{{ member.name }}" class="always-readonly" readonly required>
						</div>
						<div class="form-group">
							<label for="sex">Sex</label>
							<select id="sex" name="sex" class="always-disabled" disabled required>
								<option value="Male" {% if member.sex == 'Male' %}selected{% endif %}>Male</option>
								<option value="Female" {% if member.sex == 'Female' %}selected{% endif %}>Female</option>
							</select>
						</div>
					</div>
				</div>

				<!-- Contact Information Section -->
				<div class="form-section">
					<div class="section-header">
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
						</svg>
						<h2>Contact Information</h2>
					</div>
					<div class="form-grid">
						<div class="form-group">
							<label for="phone_number">Phone Number</label>
							<input type="tel" id="phone_number" name="phone_number" value="{{ member.phone_number }}" readonly required>
						</div>
						<div class="form-group">
							<label for="email">Email</label>
							<input type="email" id="email" name="email" value="{{ member.email|default:'' }}" readonly>
						</div>
						<div class="form-group full-width">
							<label for="address">Address</label>
							<textarea id="address" name="address" rows="2" readonly required>{{ member.address }}</textarea>
						</div>
					</div>
				</div>

				<!-- Emergency Contact Section -->
				<div class="form-section">
					<div class="section-header">
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<circle cx="12" cy="12" r="10"></circle>
							<line x1="12" y1="8" x2="12" y2="12"></line>
							<line x1="12" y1="16" x2="12.01" y2="16"></line>
						</svg>
						<h2>Emergency Contact</h2>
					</div>
					<div class="form-grid">
						<div class="form-group">
							<label for="emergency_contact">Emergency Contact Name</label>
							<input type="text" id="emergency_contact" name="emergency_contact" value="{{ member.emergency_contact }}" readonly required>
						</div>
						<div class="form-group">
							<label for="emergency_phone">Emergency Phone</label>
							<input type="tel" id="emergency_phone" name="emergency_phone" value="{{ member.emergency_phone }}" readonly required>
						</div>
					</div>
				</div>

				<!-- Membership Details Section -->
				<div class="form-section">
					<div class="section-header">
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
							<line x1="16" y1="2" x2="16" y2="6"></line>
							<line x1="8" y1="2" x2="8" y2="6"></line>
							<line x1="3" y1="10" x2="21" y2="10"></line>
						</svg>
						<h2>Membership Details</h2>
					</div>
					<div class="form-grid">
						<div class="form-group">
							<label for="start_date">Start Date</label>
							<input type="date" id="start_date" name="start_date" value="{{ member.start_date|date:'Y-m-d' }}" class="always-readonly" readonly required>
						</div>
						<div class="form-group">
							<label for="end_date">End Date</label>
							<input type="date" id="end_date" name="end_date" value="{{ member.end_date|date:'Y-m-d' }}" class="always-readonly" readonly required>
						</div>
						<div class="form-group">
							<label for="membership_fee">Membership Fee (â‚±)</label>
							<input type="number" id="membership_fee" name="membership_fee" value="{{ member.membership_fee }}" step="0.01" class="always-readonly" readonly required>
						</div>
						<div class="form-group">
							<label for="is_active">Status</label>
							<select id="is_active" name="is_active" class="always-disabled" disabled>
								<option value="true" {% if member.is_active %}selected{% endif %}>Active</option>
								<option value="false" {% if not member.is_active %}selected{% endif %}>Inactive</option>
							</select>
						</div>
					</div>
				</div>

				<!-- Action Buttons -->
				<div class="form-actions" id="formActions" style="display: none;">
					<button type="button" class="btn-secondary" id="cancelEdit">Cancel</button>
					<button type="submit" class="btn-primary">
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
							<polyline points="17 21 17 13 7 13 7 21"></polyline>
							<polyline points="7 3 7 8 15 8"></polyline>
						</svg>
						Save Changes
					</button>
				</div>
			</form>

			<!-- Delete Member Section -->
			<div class="delete-member-section">
				<div class="delete-warning">
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
						<line x1="12" y1="9" x2="12" y2="13"></line>
						<line x1="12" y1="17" x2="12.01" y2="17"></line>
					</svg>
					<div>
						<h3>Danger Zone</h3>
						<p>Deleting this member will permanently remove all associated data. This action cannot be undone.</p>
					</div>
				</div>
				<button type="button" class="btn-danger" id="deleteMemberBtn">
					<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<polyline points="3 6 5 6 21 6"></polyline>
						<path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
					</svg>
					Delete Member
				</button>
			</div>
		</div>
	</main>

	<!-- Include Reusable Delete Modal -->
	{% include 'memberships/delete_modal.html' %}

	<!-- Include Reusable Photo Options Modal -->
	{% include 'memberships/photo_modal.html' %}

	<script defer src="{% static 'core/js/notifications.js' %}"></script>
	<script defer src="{% static 'core/js/input-validator.js' %}"></script>
	<script defer src="{% static 'core/js/index.js' %}"></script>
	<script defer src="{% static 'memberships/js/member_details.js' %}"></script>
</body>
</html>
