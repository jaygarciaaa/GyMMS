{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Payment Processing | GyMMS</title>
	<link rel="stylesheet" href="{% static 'core/css/index.css' %}">
	<link rel="stylesheet" href="{% static 'payments/css/payments.css' %}">
</head>
<body>
	{% include 'core/navbar.html' %}

	<main class="container" style="margin-top:1rem">
		<div class="payments-container">
			<!-- Header -->
			<div class="payments-header">
				<div>
					<h1>Payment Processing</h1>
					<p class="subtitle">Process membership payments and renewals</p>
				</div>
			</div>

			<!-- Payment Form Card -->
			<div class="payment-form-card">
				<h2>Process Payment</h2>
				
				<form id="paymentForm">
					{% csrf_token %}
					
					<!-- Member Search/Selection -->
					<div class="form-section">
						<label for="member_search">Search Member</label>
						<div class="member-search-container">
							<input 
								type="text" 
								id="member_search" 
								placeholder="Search by Member ID, Name, Phone, or Email..."
								value="{% if selected_member %}{{ selected_member.member_id }} - {{ selected_member.name }}{% endif %}"
								autocomplete="off"
							>
							<div class="search-results" id="searchResults"></div>
						</div>
						<input type="hidden" id="member_id" name="member_id" value="{% if selected_member %}{{ selected_member.member_id }}{% endif %}" required>
					</div>

					<!-- Selected Member Info -->
					<div class="member-info-card" id="memberInfoCard" {% if not selected_member %}style="display: none;"{% endif %}>
						<div class="member-info-header">
							<h3>Selected Member</h3>
						</div>
						<div class="member-info-grid">
							<div class="info-item">
								<span class="info-label">Member ID:</span>
								<span class="info-value" id="display_member_id">{% if selected_member %}{{ selected_member.member_id }}{% endif %}</span>
							</div>
							<div class="info-item">
								<span class="info-label">Name:</span>
								<span class="info-value" id="display_member_name">{% if selected_member %}{{ selected_member.name }}{% endif %}</span>
							</div>
							<div class="info-item">
								<span class="info-label">Phone:</span>
								<span class="info-value" id="display_member_phone">{% if selected_member %}{{ selected_member.phone_number }}{% endif %}</span>
							</div>
							<div class="info-item">
								<span class="info-label">Current Status:</span>
								<span class="info-value" id="display_member_status">
									{% if selected_member %}
										{% if selected_member.is_active and selected_member.end_date >= today %}
											<span class="badge badge-active">Active</span>
										{% else %}
											<span class="badge badge-expired">Expired</span>
										{% endif %}
									{% endif %}
								</span>
							</div>
							<div class="info-item">
								<span class="info-label">Expires:</span>
								<span class="info-value" id="display_member_end_date">{% if selected_member %}{{ selected_member.end_date|date:"M d, Y" }}{% endif %}</span>
							</div>
						</div>
					</div>

					<!-- Pricing Selection -->
					<div class="form-section">
						<label for="pricing_id">Select Duration</label>
						<div class="pricing-options">
							{% for pricing in pricing_options %}
							<label class="pricing-card">
								<input type="radio" name="pricing_id" value="{{ pricing.id }}" required>
								<div class="pricing-content">
									<div class="pricing-duration">{{ pricing.duration_label }}</div>
									<div class="pricing-price">â‚±{{ pricing.price }}</div>
									<div class="pricing-days">{{ pricing.duration_days }} days</div>
								</div>
							</label>
							{% empty %}
							<p class="text-muted">No pricing options available. Please contact the administrator.</p>
							{% endfor %}
						</div>
					</div>

					<!-- Payment Method -->
					<div class="form-section">
						<label for="payment_method">Payment Method</label>
						<select id="payment_method" name="payment_method" required>
							<option value="">Select payment method...</option>
							<option value="Cash">Cash</option>
							<option value="GCash">GCash</option>
							<option value="Maya">Maya</option>
							<option value="GTyme">GTyme</option>
							<option value="Bank Transfer">Bank Transfer</option>
							<option value="PayPal">PayPal</option>
							<option value="Debit Card">Debit Card</option>
							<option value="Credit Card">Credit Card</option>
						</select>
					</div>

					<!-- Reference Number (conditional) -->
					<div class="form-section" id="referenceSection" style="display: none;">
						<label for="reference_number">Reference / Transaction Number</label>
						<input 
							type="text" 
							id="reference_number" 
							name="reference_number" 
							placeholder="Enter reference/transaction number"
						>
					</div>

					<!-- Remarks -->
					<div class="form-section">
						<label for="remarks">Remarks (Optional)</label>
						<textarea 
							id="remarks" 
							name="remarks" 
							rows="3" 
							placeholder="Add any additional notes..."
						></textarea>
					</div>

					<!-- Submit Button -->
					<div class="form-actions">
						<button type="submit" class="btn-primary" id="submitBtn">
							<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<polyline points="20 6 9 17 4 12"></polyline>
							</svg>
							Process Payment
						</button>
					</div>
				</form>
			</div>

			<!-- Recent Payments Section -->
			<div class="recent-payments-section">
				<div class="section-header">
					<h2>Recent Payments</h2>
					<div class="header-actions">
						<div class="payment-search-box">
							<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<circle cx="11" cy="11" r="8"></circle>
								<path d="m21 21-4.35-4.35"></path>
							</svg>
							<input 
								type="text" 
								id="paymentSearchInput" 
								placeholder="Search payments by Member ID, Name, or Reference..."
								value="{{ search_query }}"
							>
						</div>
						<a href="/payments/transactions/" class="btn-view-history">
							<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<path d="M3 3v18h18"/>
								<path d="m19 9-5 5-4-4-3 3"/>
							</svg>
							View All Transactions
						</a>
					</div>
				</div>

				<div class="payments-table-container">
					<table class="payments-table">
						<thead>
							<tr>
								<th>Date</th>
								<th>Member ID</th>
								<th>Member Name</th>
								<th>Amount</th>
								<th>Method</th>
								<th>Reference</th>
								<th>Status</th>
								<th>Processed By</th>
							</tr>
						</thead>
						<tbody>
							{% for payment in recent_payments %}
							<tr>
								<td>{{ payment.payment_date|date:"M d, Y H:i" }}</td>
								<td><span class="member-id-badge">{{ payment.stored_member_id }}</span></td>
								<td>{{ payment.stored_member_name }}</td>
								<td class="amount">â‚±{{ payment.amount }}</td>
								<td><span class="method-badge method-{{ payment.payment_method|lower }}">{{ payment.payment_method }}</span></td>
								<td>{{ payment.reference_number|default:"â€”" }}</td>
								<td>
									<span class="status-badge status-{{ payment.status|lower }}">{{ payment.status }}</span>
								</td>
								<td>{{ payment.processed_by.username }}</td>
							</tr>
							{% empty %}
							<tr>
								<td colspan="8" class="empty-state">
									<div class="empty-icon">ðŸ’³</div>
									<p>No payment records found</p>
								</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</main>

	<script defer src="{% static 'payments/js/payments.js' %}"></script>
</body>
</html>