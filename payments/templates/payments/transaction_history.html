{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Transaction History | GyMMS</title>
	<link rel="stylesheet" href="{% static 'core/css/index.css' %}">
	<link rel="stylesheet" href="{% static 'payments/css/transaction_history.css' %}?v=6.0">
</head>
<body>
	{% include 'core/navbar.html' %}
	<main class="container" style="margin-top:0.5rem">
		<div class="transaction-history-container">
		<!-- Header -->
		<div class="page-header">
			<div>
				<h1>Transaction History</h1>
				<p class="subtitle">View and search all payment transactions</p>
			</div>
			<a href="/payments/" class="btn-back">
				<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<path d="m12 19-7-7 7-7"/>
					<path d="M19 12H5"/>
				</svg>
				Back to Payments
			</a>
		</div>			<!-- Filters Card -->
			<div class="filters-card">
				<div class="filters-grid">
					<!-- Search Bar -->
					<div class="filter-group search-group">
						<label for="searchInput">
							<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<circle cx="11" cy="11" r="8"></circle>
								<path d="m21 21-4.35-4.35"></path>
							</svg>
							Search
						</label>
						<input 
							type="text" 
							id="searchInput" 
							placeholder="Member ID, Name, Reference Number..."
							value="{{ search_query }}"
						>
					</div>

					<!-- Date From -->
					<div class="filter-group">
						<label for="dateFrom">
							<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
								<line x1="16" x2="16" y1="2" y2="6"/>
								<line x1="8" x2="8" y1="2" y2="6"/>
								<line x1="3" x2="21" y1="10" y2="10"/>
							</svg>
							From Date
						</label>
						<input 
							type="date" 
							id="dateFrom" 
							value="{{ date_from }}"
						>
					</div>

					<!-- Date To -->
					<div class="filter-group">
						<label for="dateTo">
							<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
								<line x1="16" x2="16" y1="2" y2="6"/>
								<line x1="8" x2="8" y1="2" y2="6"/>
								<line x1="3" x2="21" y1="10" y2="10"/>
							</svg>
							To Date
						</label>
						<input 
							type="date" 
							id="dateTo" 
							value="{{ date_to }}"
						>
					</div>

					<!-- Payment Method Filter -->
					<div class="filter-group">
						<label for="paymentMethodFilter">
							<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<rect width="20" height="14" x="2" y="5" rx="2"/>
								<line x1="2" x2="22" y1="10" y2="10"/>
							</svg>
							Payment Method
						</label>
						<select id="paymentMethodFilter">
							<option value="" {% if not payment_method %}selected{% endif %}>All Methods</option>
							<option value="Cash" {% if payment_method == 'Cash' %}selected{% endif %}>Cash</option>
							<option value="Digital" {% if payment_method == 'Digital' %}selected{% endif %}>Digital Transactions (All)</option>
							<option value="GCash" {% if payment_method == 'GCash' %}selected{% endif %}>GCash</option>
							<option value="Maya" {% if payment_method == 'Maya' %}selected{% endif %}>Maya</option>
							<option value="GoTyme" {% if payment_method == 'GoTyme' %}selected{% endif %}>GoTyme</option>
							<option value="Bank Transfer" {% if payment_method == 'Bank Transfer' %}selected{% endif %}>Bank Transfer</option>
							<option value="PayPal" {% if payment_method == 'PayPal' %}selected{% endif %}>PayPal</option>
							<option value="Debit Card" {% if payment_method == 'Debit Card' %}selected{% endif %}>Debit Card</option>
							<option value="Credit Card" {% if payment_method == 'Credit Card' %}selected{% endif %}>Credit Card</option>
						</select>
					</div>

					<!-- Member Type Filter -->
					<div class="filter-group">
						<label for="memberTypeFilter">
							<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
								<circle cx="9" cy="7" r="4"></circle>
								<path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
								<path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
							</svg>
							Customer Type
						</label>
						<select id="memberTypeFilter">
							<option value="" {% if not member_type %}selected{% endif %}>All Customers</option>
							<option value="member" {% if member_type == 'member' %}selected{% endif %}>Members Only</option>
							<option value="walkin" {% if member_type == 'walkin' %}selected{% endif %}>Walk-ins Only</option>
						</select>
					</div>

					<!-- Clear Filters Button -->
					<div class="filter-group filter-actions">
						<button type="button" id="clearFilters" class="btn-clear">
							<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<path d="M3 6h18"/>
								<path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
								<path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
								<line x1="10" x2="10" y1="11" y2="17"/>
								<line x1="14" x2="14" y1="11" y2="17"/>
							</svg>
							Clear Filters
						</button>
					</div>
				</div>
			</div>

		<!-- Summary Stats -->
		<div class="summary-stats-section">
			<!-- Time Period Filter -->
			<div class="stats-header">
				<h3>
					<a href="{% url 'metrics:metrics' %}" class="stats-title-link">
						Summary Statistics
					</a>
				</h3>
				<div class="time-period-filter">
					<button type="button" class="period-btn active" data-period="1d">1D</button>
					<button type="button" class="period-btn" data-period="1w">1W</button>
					<button type="button" class="period-btn" data-period="1m">1M</button>
					<button type="button" class="period-btn" data-period="6m">6M</button>
					<button type="button" class="period-btn" data-period="1y">1Y</button>
					<button type="button" class="period-btn" data-period="all">All</button>
				</div>
			</div>

			<div class="summary-stats">
				<div class="stat-card">
					<div class="stat-icon stat-icon-total">
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<line x1="12" x2="12" y1="2" y2="22"/>
							<path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
						</svg>
					</div>
					<div class="stat-content">
						<div class="stat-label">
							<a href="{% url 'metrics:metrics' %}?filter=revenue" class="stat-label-link">
								Total Revenue
							</a>
						</div>
						<div class="stat-value" id="totalRevenue">‚Ç±{{ total_revenue|floatformat:2|default:"0.00" }}</div>
					</div>
				</div>

				<div class="stat-card">
					<div class="stat-icon stat-icon-count">
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M3 3v18h18"/>
							<path d="m19 9-5 5-4-4-3 3"/>
						</svg>
					</div>
					<div class="stat-content">
						<div class="stat-label">
							<a href="{% url 'metrics:metrics' %}?filter=transactions" class="stat-label-link">
								Total Transactions
							</a>
						</div>
						<div class="stat-value" id="totalCount">{{ total_count|default:0 }}</div>
					</div>
				</div>

				<div class="stat-card">
					<div class="stat-icon stat-icon-avg">
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
						</svg>
					</div>
					<div class="stat-content">
						<div class="stat-label">
							<a href="{% url 'metrics:metrics' %}?filter=average_transactions" class="stat-label-link">
								Average Transaction
							</a>
						</div>
						<div class="stat-value" id="averageAmount">‚Ç±{{ average_amount|floatformat:2|default:"0.00" }}</div>
					</div>
				</div>
			</div>
		</div>			<!-- Transactions Table -->
			<div class="transactions-table-card">
				<div class="table-container">
					<table class="transactions-table">
						<thead>
							<tr>
								<th>Transaction ID</th>
								<th>Date & Time</th>
								<th>Member ID</th>
								<th>Member Name</th>
								<th>Membership Plan</th>
								<th>Amount</th>
								<th>Payment Method</th>
								<th>Reference</th>
								<th>Processed By</th>
							</tr>
						</thead>
						<tbody>
							{% for transaction in transactions %}
							<tr>
								<td>
									<span class="transaction-id" title="{{ transaction.id }}">
										{{ transaction.id }}
									</span>
								</td>
								<td>{{ transaction.payment_date|date:"M d, Y H:i" }}</td>
								<td><span class="member-id-badge">{{ transaction.stored_member_id }}</span></td>
								<td>{{ transaction.stored_member_name }}</td>
								<td>
									<span class="plan-info">
										{{ transaction.stored_plan_label|default:"N/A" }}
										{% if transaction.stored_duration_days > 0 %}
											<small>({{ transaction.stored_duration_days }} days)</small>
										{% endif %}
									</span>
								</td>
								<td class="amount">‚Ç±{{ transaction.amount }}</td>
								<td>
									<span class="method-badge method-{{ transaction.payment_method|lower|cut:' ' }}">
										{{ transaction.payment_method }}
									</span>
								</td>
								<td>{{ transaction.reference_number|default:"‚Äî" }}</td>
								<td>{{ transaction.processed_by.username|default:"‚Äî" }}</td>
							</tr>
							{% empty %}
							<tr>
								<td colspan="9" class="empty-state">
									<div class="empty-icon">üìä</div>
									<p>No transactions found</p>
									<small>Try adjusting your filters or search criteria</small>
								</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>

				<!-- Pagination Controls -->
				<div class="pagination-container">
					<div class="pagination-info">
						Showing {{ start_index }} to {{ end_index }} of {{ total_count }} transactions
					</div>
					
					<div class="pagination-controls">
						<button 
							type="button" 
							id="prevPage" 
							class="pagination-btn"
							{% if not has_previous %}disabled{% endif %}
							title="Previous page"
						>
							‚Üê
						</button>

						<input 
							type="number" 
							id="pageInput" 
							class="page-number-input"
							value="{{ current_page }}" 
							min="1" 
							max="{{ total_pages }}"
							title="Current page"
						>

						<button 
							type="button" 
							id="nextPage" 
							class="pagination-btn"
							{% if not has_next %}disabled{% endif %}
							title="Next page"
						>
							‚Üí
						</button>
					</div>

					<div class="per-page-selector">
						<label for="perPageSelect">Show:</label>
						<select id="perPageSelect">
							<option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
							<option value="25" {% if per_page == 25 %}selected{% endif %}>25</option>
							<option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
						</select>
					</div>
				</div>
			</div>
		</div>
	</main>

	<script defer src="{% static 'core/js/notifications.js' %}"></script>
	<script defer src="{% static 'core/js/input-validator.js' %}"></script>
	<script defer src="{% static 'payments/js/transaction_history.js' %}?v=3.0"></script>
</body>
</html>
