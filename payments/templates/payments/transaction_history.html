{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Transaction History | GyMMS</title>
	<link rel="stylesheet" href="{% static 'core/css/index.css' %}">
	<link rel="stylesheet" href="{% static 'payments/css/transaction_history.css' %}">
</head>
<body>
	{% include 'core/navbar.html' %}
	<main class="container" style="margin-top:1rem">
		<div class="transaction-history-container">
			<!-- Header -->
			<div class="page-header">
				<div>
					<h1>Transaction History</h1>
					<p class="subtitle">View and search all payment transactions</p>
				</div>
				<a href="/payments/" class="btn-back">
					<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="m12 19-7-7 7-7"/>
						<path d="M19 12H5"/>
					</svg>
					Back to Payments
				</a>
			</div>

			<!-- Filters Card -->
			<div class="filters-card">
				<div class="filters-grid">
					<!-- Search Bar -->
					<div class="filter-group search-group">
						<label for="searchInput">
							<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<circle cx="11" cy="11" r="8"></circle>
								<path d="m21 21-4.35-4.35"></path>
							</svg>
							Search
						</label>
						<input 
							type="text" 
							id="searchInput" 
							placeholder="Member ID, Name, Reference Number..."
							value="{{ search_query }}"
						>
					</div>

					<!-- Date From -->
					<div class="filter-group">
						<label for="dateFrom">
							<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
								<line x1="16" x2="16" y1="2" y2="6"/>
								<line x1="8" x2="8" y1="2" y2="6"/>
								<line x1="3" x2="21" y1="10" y2="10"/>
							</svg>
							From Date
						</label>
						<input 
							type="date" 
							id="dateFrom" 
							value="{{ date_from }}"
						>
					</div>

					<!-- Date To -->
					<div class="filter-group">
						<label for="dateTo">
							<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
								<line x1="16" x2="16" y1="2" y2="6"/>
								<line x1="8" x2="8" y1="2" y2="6"/>
								<line x1="3" x2="21" y1="10" y2="10"/>
							</svg>
							To Date
						</label>
						<input 
							type="date" 
							id="dateTo" 
							value="{{ date_to }}"
						>
					</div>

					<!-- Payment Method Filter -->
					<div class="filter-group">
						<label for="paymentMethodFilter">
							<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<rect width="20" height="14" x="2" y="5" rx="2"/>
								<line x1="2" x2="22" y1="10" y2="10"/>
							</svg>
							Payment Method
						</label>
						<select id="paymentMethodFilter">
							<option value="">All Methods</option>
							<option value="Cash">Cash</option>
							<option value="GCash">GCash</option>
							<option value="Maya">Maya</option>
							<option value="GTyme">GTyme</option>
							<option value="Bank Transfer">Bank Transfer</option>
							<option value="PayPal">PayPal</option>
							<option value="Debit Card">Debit Card</option>
							<option value="Credit Card">Credit Card</option>
						</select>
					</div>

					<!-- Status Filter -->
					<div class="filter-group">
						<label for="statusFilter">
							<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
								<polyline points="22 4 12 14.01 9 11.01"/>
							</svg>
							Status
						</label>
						<select id="statusFilter">
							<option value="">All Status</option>
							<option value="Completed">Completed</option>
							<option value="Failed">Failed</option>
							<option value="Refunded">Refunded</option>
						</select>
					</div>

					<!-- Clear Filters Button -->
					<div class="filter-group filter-actions">
						<button type="button" id="clearFilters" class="btn-clear">
							<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<path d="M3 6h18"/>
								<path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
								<path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
								<line x1="10" x2="10" y1="11" y2="17"/>
								<line x1="14" x2="14" y1="11" y2="17"/>
							</svg>
							Clear Filters
						</button>
					</div>
				</div>
			</div>

			<!-- Summary Stats -->
			<div class="summary-stats">
				<div class="stat-card">
					<div class="stat-icon stat-icon-total">
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<line x1="12" x2="12" y1="2" y2="22"/>
							<path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
						</svg>
					</div>
					<div class="stat-content">
						<div class="stat-label">Total Revenue</div>
						<div class="stat-value">â‚±{{ total_revenue|floatformat:2|default:"0.00" }}</div>
					</div>
				</div>

				<div class="stat-card">
					<div class="stat-icon stat-icon-count">
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M3 3v18h18"/>
							<path d="m19 9-5 5-4-4-3 3"/>
						</svg>
					</div>
					<div class="stat-content">
						<div class="stat-label">Total Transactions</div>
						<div class="stat-value">{{ total_count|default:0 }}</div>
					</div>
				</div>

				<div class="stat-card">
					<div class="stat-icon stat-icon-avg">
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
						</svg>
					</div>
					<div class="stat-content">
						<div class="stat-label">Average Transaction</div>
						<div class="stat-value">â‚±{{ average_amount|floatformat:2|default:"0.00" }}</div>
					</div>
				</div>
			</div>

			<!-- Transactions Table -->
			<div class="transactions-table-card">
				<div class="table-container">
					<table class="transactions-table">
						<thead>
							<tr>
								<th>Transaction ID</th>
								<th>Date & Time</th>
								<th>Member ID</th>
								<th>Member Name</th>
								<th>Amount</th>
								<th>Payment Method</th>
								<th>Reference</th>
								<th>Status</th>
								<th>Processed By</th>
							</tr>
						</thead>
						<tbody>
							{% for transaction in transactions %}
							<tr>
								<td>
									<span class="transaction-id" title="{{ transaction.id }}">
										{{ transaction.id|slice:":8" }}...
									</span>
								</td>
								<td>{{ transaction.payment_date|date:"M d, Y H:i" }}</td>
								<td><span class="member-id-badge">{{ transaction.stored_member_id }}</span></td>
								<td>{{ transaction.stored_member_name }}</td>
								<td class="amount">â‚±{{ transaction.amount }}</td>
								<td>
									<span class="method-badge method-{{ transaction.payment_method|lower|cut:' ' }}">
										{{ transaction.payment_method }}
									</span>
								</td>
								<td>{{ transaction.reference_number|default:"â€”" }}</td>
								<td>
									<span class="status-badge status-{{ transaction.status|lower }}">
										{{ transaction.status }}
									</span>
								</td>
								<td>{{ transaction.processed_by.username|default:"â€”" }}</td>
							</tr>
							{% empty %}
							<tr>
								<td colspan="9" class="empty-state">
									<div class="empty-icon">ðŸ“Š</div>
									<p>No transactions found</p>
									<small>Try adjusting your filters or search criteria</small>
								</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>

				<!-- Pagination Controls -->
				<div class="pagination-container">
					<div class="pagination-info">
						Showing {{ start_index }} to {{ end_index }} of {{ total_count }} transactions
					</div>
					
					<div class="pagination-controls">
						<button 
							type="button" 
							id="prevPage" 
							class="pagination-btn"
							{% if not has_previous %}disabled{% endif %}
						>
							<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<polyline points="15 18 9 12 15 6"/>
							</svg>
						</button>

						<div class="page-input-group">
							<span>Page</span>
							<input 
								type="number" 
								id="pageInput" 
								value="{{ current_page }}" 
								min="1" 
								max="{{ total_pages }}"
							>
							<span>of {{ total_pages }}</span>
						</div>

						<button 
							type="button" 
							id="nextPage" 
							class="pagination-btn"
							{% if not has_next %}disabled{% endif %}
						>
							<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<polyline points="9 18 15 12 9 6"/>
							</svg>
						</button>
					</div>

					<div class="per-page-selector">
						<label for="perPageSelect">Show:</label>
						<select id="perPageSelect">
							<option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
							<option value="25" {% if per_page == 25 %}selected{% endif %}>25</option>
							<option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
							<option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
						</select>
					</div>
				</div>
			</div>
		</div>
	</main>

	<script defer src="{% static 'payments/js/transaction_history.js' %}"></script>
</body>
</html>
